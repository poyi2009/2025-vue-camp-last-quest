import{c as n,o as i,F as x,r as D,a as t,w as z,v as S,t as y,b as p,d as f,e as U,f as _,u as N,g as A,n as L,h as B}from"./index-DN38krNz.js";const I={class:"todoList_item"},M={class:"todoList_label"},O={key:0},P=["onClick"],q={key:1},F=["onClick"],R={key:2},J=["onUpdate:modelValue"],j={key:3},G={style:{color:"gray"}},H={key:4},K=["onClick"],Q=["onClick"],W=["onClick"],X=["onClick"],Y={__name:"TheTodolist",props:{filterList:{type:Array,require:!0},token:{type:String,require:!0}},emits:["change-todo-status","edit-todo","save-todo","delete-todo"],setup(w,{emit:m}){const a=w,h=m,r=l=>{h("change-todo-status",l)},k=l=>{h("save-todo",l)},$=l=>{h("delete-todo",l)},T=l=>{const d=a.filterList.find(s=>s.id===l);d.isEditng=!0},C=l=>{const d=a.filterList.find(s=>s.id===l);d.tempContent=d.content,d.isEditng=!1};return(l,d)=>(i(),n("ul",I,[(i(!0),n(x,null,D(a.filterList,s=>(i(),n("li",{key:s.id},[t("label",M,[s.status?(i(),n("div",O,[t("input",{class:"todoList_input",type:"checkbox",checked:"",onClick:c=>r(s.id)},null,8,P)])):(i(),n("div",q,[t("input",{class:"todoList_input",type:"checkbox",onClick:c=>r(s.id)},null,8,F)])),s.isEditng?(i(),n("div",R,[z(t("input",{type:"text","onUpdate:modelValue":c=>s.tempContent=c},null,8,J),[[S,s.tempContent]])])):s.status?(i(),n("div",j,[t("del",G,y(s.content),1)])):(i(),n("div",H,[t("span",null,y(s.content),1)]))]),s.isEditng?(i(),n(x,{key:0},[t("a",{href:"#",onClick:p(c=>k(s.id),["prevent"]),style:{color:"green","text-decoration":"none"}},"SAVE",8,K),t("a",{href:"#",onClick:p(c=>C(s.id),["prevent"]),style:{color:"red","text-decoration":"none"}},"CANCEL",8,Q)],64)):(i(),n(x,{key:1},[t("a",{href:"#",onClick:p(c=>T(s.id),["prevent"]),style:{"text-decoration":"none"}},"EDIT",8,W),t("a",{href:"#",onClick:p(c=>$(s.id),["prevent"]),style:{"text-decoration":"none"}},"Ｘ",8,X)],64))]))),128))]))}},Z={id:"todoListPage",class:"bg-half"},tt={class:"todo_sm"},et={href:"#"},ot={class:"conatiner todoListPage vhContainer"},st={class:"todoList_Content"},at={class:"inputBox"},nt={key:0},it={key:1,class:"todoList_list"},lt={class:"todoList_tab"},dt={class:"todoList_items"},rt={class:"todoList_statistics"},g="https://todolist-api.hexschool.io",ut={__name:"TodolistView",setup(w){const m=N(),a=f(""),h=f({nickname:"",uid:""}),r=f([]),k=f("");U(async()=>{try{await $(),await d()}catch(o){alert(`${o.response.data.message}`)}});const $=async()=>{try{if(a.value=document.cookie.replace(/(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$/i,"$1"),a.value){const o=await _.get(`${g}/users/checkout`,{headers:{Authorization:a.value}});h.value.nickname=o.data.nickname,h.value.uid=o.data.uid,await d()}else m.push("/")}catch(o){alert(`${o.response.data.message}`)}},T=A(()=>r.value.filter(e=>!e.status).length),C=async()=>{try{const o=await _.post(`${g}/users/sign_out`,{},{headers:{Authorization:a.value}});document.cookie="customTodoToken=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=;",a.value=null,alert(`${o.data.message}`),await $()}catch(o){alert(`${o.response.data.message}`)}},l=async()=>{try{const o=await _.post(`${g}/todos/`,{content:k.value.trim()},{headers:{Authorization:a.value}});k.value="",await d(),alert(`${o.data.newTodo.content} 新增待辦成功`)}catch(o){alert(`${o.response.data.message}`)}},d=async()=>{try{const e=(await _.get(`${g}/todos/`,{headers:{Authorization:a.value}})).data.data.map(u=>({...u,tempContent:u.content,isEditing:!1}));r.value=e}catch(o){alert(`${o.response.data.message}`)}},s=async o=>{try{const e=await _.patch(`${g}/todos/${o}/toggle`,{},{headers:{Authorization:a.value}});alert(`${e.data.message}`),await d()}catch(e){alert(`${e.response.data.message}`)}},c=async o=>{try{const e=E.value.find(V=>V.id===o),u=await _.put(`${g}/todos/${o}`,{content:e.tempContent.trim()},{headers:{Authorization:a.value}});e.isEditng=!1,alert(`${u.data.message}`),await d()}catch(e){alert(`${e.response.data.message}`)}},b=async o=>{try{const e=await _.delete(`${g}/todos/${o}`,{headers:{Authorization:a.value}});alert(e.data.message),await $()}catch(e){alert(`${e.response.data.message}`)}},v=f("all"),E=A(()=>v.value==="todo"?r.value.filter(o=>o.status===!1):v.value==="done"?r.value.filter(o=>o.status===!0):r.value);return(o,e)=>(i(),n("div",Z,[t("nav",null,[e[4]||(e[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",tt,[t("a",et,[t("span",null,y(h.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{href:"#",onClick:C},"登出")])])]),t("div",ot,[t("div",st,[t("div",at,[z(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":e[0]||(e[0]=u=>k.value=u)},null,512),[[S,k.value]]),t("a",{href:"#",onClick:p(l,["prevent"])},[...e[5]||(e[5]=[t("i",{class:"fa fa-plus"},"+",-1)])])]),r.value.length===0?(i(),n("div",nt,[...e[6]||(e[6]=[t("p",{style:{"text-align":"center","font-size":"16px",color:"#333333","padding-top":"20px"}}," 目前尚無待辦事項 ",-1)])])):(i(),n("div",it,[t("ul",lt,[t("li",null,[t("a",{href:"#",onClick:e[1]||(e[1]=p(u=>v.value="all",["prevent"])),class:L({active:v.value==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:e[2]||(e[2]=p(u=>v.value="todo",["prevent"])),class:L({active:v.value==="todo"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:e[3]||(e[3]=p(u=>v.value="done",["prevent"])),class:L({active:v.value==="done"})},"已完成",2)])]),t("div",dt,[B(Y,{filterList:E.value,token:a.value,onChangeTodoStatus:s,onSaveTodo:c,onDeleteTodo:b},null,8,["filterList","token"]),t("div",rt,[t("p",null,y(T.value)+" 個待完成項目",1)])])]))])])]))}};export{ut as default};
