import{c as a,o as i,F as x,r as D,a as t,w as b,v as z,t as y,b as v,d as f,e as U,f as k,u as N,g as A,n as L,h as B}from"./index-BktI-SC2.js";const I={class:"todoList_item"},M={class:"todoList_label"},O={key:0},P=["onClick"],q={key:1},F=["onClick"],R={key:2},J=["onClick"],j={key:3},G=["onUpdate:modelValue"],H={key:4},K={style:{color:"gray"}},Q={key:5},W=["onClick"],X=["onClick"],Y=["onClick"],Z=["onClick"],tt={__name:"TheTodolist",props:{filterList:{type:Array,require:!0},token:{type:String,require:!0}},emits:["change-todo-status","edit-todo","save-todo","delete-todo"],setup(w,{emit:$}){const n=w,h=$,r=l=>{h("change-todo-status",l)},_=l=>{h("save-todo",l)},m=l=>{h("delete-todo",l)},T=l=>{const d=n.filterList.find(s=>s.id===l);d.isEditng=!0},C=l=>{const d=n.filterList.find(s=>s.id===l);d.tempContent=d.content,d.isEditng=!1};return(l,d)=>(i(),a("ul",I,[(i(!0),a(x,null,D(n.filterList,s=>(i(),a("li",{key:s.id},[t("label",M,[s.isEditng?(i(),a("div",O,[t("input",{class:"todoList_input",type:"checkbox",onClick:c=>r(s.id),disabled:""},null,8,P)])):s.status?(i(),a("div",q,[t("input",{class:"todoList_input",type:"checkbox",checked:"",onClick:c=>r(s.id)},null,8,F)])):(i(),a("div",R,[t("input",{class:"todoList_input",type:"checkbox",onClick:c=>r(s.id)},null,8,J)])),s.isEditng?(i(),a("div",j,[b(t("input",{type:"text","onUpdate:modelValue":c=>s.tempContent=c},null,8,G),[[z,s.tempContent]])])):s.status?(i(),a("div",H,[t("del",K,y(s.content),1)])):(i(),a("div",Q,[t("span",null,y(s.content),1)]))]),s.isEditng?(i(),a(x,{key:0},[t("a",{href:"#",onClick:v(c=>_(s.id),["prevent"]),style:{color:"green","text-decoration":"none"}},"SAVE",8,W),t("a",{href:"#",onClick:v(c=>C(s.id),["prevent"]),style:{color:"red","text-decoration":"none"}},"CANCEL",8,X)],64)):(i(),a(x,{key:1},[t("a",{href:"#",onClick:v(c=>T(s.id),["prevent"]),style:{"text-decoration":"none"}},"EDIT",8,Y),t("a",{href:"#",onClick:v(c=>m(s.id),["prevent"]),style:{"text-decoration":"none"}},"Ｘ",8,Z)],64))]))),128))]))}},et={id:"todoListPage",class:"bg-half"},ot={class:"todo_sm"},st={href:"#"},nt={class:"conatiner todoListPage vhContainer"},at={class:"todoList_Content"},it={class:"inputBox"},lt={key:0},dt={key:1,class:"todoList_list"},rt={class:"todoList_tab"},ct={class:"todoList_items"},ut={class:"todoList_statistics"},g="https://todolist-api.hexschool.io",pt={__name:"TodolistView",setup(w){const $=N(),n=f(""),h=f({nickname:"",uid:""}),r=f([]),_=f("");U(async()=>{try{await m(),n.value&&await d()}catch(o){alert(`${o.response.data.message}`)}});const m=async()=>{try{if(n.value=document.cookie.replace(/(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$/i,"$1"),n.value){const o=await k.get(`${g}/users/checkout`,{headers:{Authorization:n.value}});h.value.nickname=o.data.nickname,h.value.uid=o.data.uid}else $.push("/")}catch(o){alert(`驗證失敗: ${o.response.data.message}`)}},T=A(()=>r.value.filter(e=>!e.status).length),C=async()=>{try{const o=await k.post(`${g}/users/sign_out`,{},{headers:{Authorization:n.value}});document.cookie="customTodoToken=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=;",n.value=null,alert(`${o.data.message}`),$.replace("/")}catch(o){alert(`登出失敗: ${o.response.data.message}`)}},l=async()=>{try{if(!_.value.trim()){alert("新增事項不可為空");return}const o=await k.post(`${g}/todos/`,{content:_.value.trim()},{headers:{Authorization:n.value}});_.value="",alert(`${o.data.newTodo.content} 新增待辦成功`),await d()}catch(o){alert(`新增清單失敗: ${o.response.data.message}`)}},d=async()=>{try{const e=(await k.get(`${g}/todos/`,{headers:{Authorization:n.value}})).data.data.map(u=>({...u,tempContent:u.content,isEditing:!1}));r.value=e}catch(o){alert(`讀取清單失敗: ${o.response.data.message}`)}},s=async o=>{try{const e=await k.patch(`${g}/todos/${o}/toggle`,{},{headers:{Authorization:n.value}});alert(`${e.data.message}`),await d()}catch(e){alert(`更新清單狀態失敗: ${e.response.data.message}`)}},c=async o=>{try{const e=E.value.find(V=>V.id===o),u=await k.put(`${g}/todos/${o}`,{content:e.tempContent.trim()},{headers:{Authorization:n.value}});e.isEditng=!1,alert(`${u.data.message}`),await d()}catch(e){alert(`儲存清單失敗: ${e.response.data.message}`)}},S=async o=>{try{const e=await k.delete(`${g}/todos/${o}`,{headers:{Authorization:n.value}});alert(e.data.message),await d()}catch(e){alert(`刪除清單失敗: ${e.response.data.message}`)}},p=f("all"),E=A(()=>p.value==="todo"?r.value.filter(o=>o.status===!1):p.value==="done"?r.value.filter(o=>o.status===!0):r.value);return(o,e)=>(i(),a("div",et,[t("nav",null,[e[4]||(e[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",ot,[t("a",st,[t("span",null,y(h.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{href:"#",onClick:v(C,["prevent"])},"登出")])])]),t("div",nt,[t("div",at,[t("div",it,[b(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":e[0]||(e[0]=u=>_.value=u)},null,512),[[z,_.value]]),t("a",{href:"#",onClick:v(l,["prevent"])},[...e[5]||(e[5]=[t("i",{class:"fa fa-plus"},"+",-1)])])]),r.value.length===0?(i(),a("div",lt,[...e[6]||(e[6]=[t("p",{style:{"text-align":"center","font-size":"16px",color:"#333333","padding-top":"20px"}}," 目前尚無待辦事項 ",-1)])])):(i(),a("div",dt,[t("ul",rt,[t("li",null,[t("a",{href:"#",onClick:e[1]||(e[1]=v(u=>p.value="all",["prevent"])),class:L({active:p.value==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:e[2]||(e[2]=v(u=>p.value="todo",["prevent"])),class:L({active:p.value==="todo"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:e[3]||(e[3]=v(u=>p.value="done",["prevent"])),class:L({active:p.value==="done"})},"已完成",2)])]),t("div",ct,[B(tt,{filterList:E.value,token:n.value,onChangeTodoStatus:s,onSaveTodo:c,onDeleteTodo:S},null,8,["filterList","token"]),t("div",ut,[t("p",null,y(T.value)+" 個待完成項目",1)])])]))])])]))}};export{pt as default};
